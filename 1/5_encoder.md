# 수행 목표
엔코더 모터에 대해 학습한다.

# 엔코더 모터 학습

## 1.엔코더 모터의 정의

### 1-1. 엔코더(Encoder) 개념
 - **엔코더(Encoder)는 모터의 위치, 속도, 방향 등의 정보를 감지하고 이를 전기 신호로 변환하는 장치** 이다.

 - 기본적으로 엔코더는 회전하거나 선형으로 움직이는 기계 부품의 운동을 디지털 신호로 변환하는 센서다.

 - 엔코더는 회전 위치를 측정하는 데 자주 사용되어, 서보 모터(Servo Motor)나 스텝 모터(Stepper Motor)같은 정밀 제어가 필요한 시스템에서 필수적으로 사용된다.

 ### 1-2. 엔코더 모터(Encoder Motor) 개념
 - 엔코더 모터는 위치, 속도, 방향을 감지하기 위해 엔코더가 부착된 모터이다.  

 - 로봇에서는 주로 정확한 속도 제어 및 거리 계산, 폐루프 제어를 위해 사용된다.  

## 2.엔코더 부의 역할 및 구성 방식과 작동원리

### 2-1. 엔코더 역할
 - **위치 측정**: 엔코더는 모터의 현재 위치를 실시간으로 측정한다.

 - **속도 측정**: 엔코더는 회전 속도를 계산하는 데 사용 되고, 모터의 속도를 변경하는 것이 가능하다.

 - **방향 감지**: 엔코더는 모터가 회전하는 방향을 감지한다.

 - **피드백 루프**: 속도, 방향, 이동 거리 등의 데이터를 MCU에 제공한다.  

### 2-2. 엔코더 부의 구성 방식 및 작동 원리
 - **광학식 엔코더**: 광원(LED)과 수광부(포토다이오드, 포토트랜지스터)가 디스크의 회전으로 인해 빛의 차단과 통과를 감지하여 신호를 생성한다.   
     - 디스크에는 일정한 간격으로 구명이 뚫려 있어 이 구멍을 통해 빛이 통과할 때 수광부에서 펄스 신호가 발생한다.  
     - **펄스 수**: 위치(각도)를 알 수 있다.
     - **펄스 간격**: 속도를 알 수 있다.
     - **A,B 신호의 위상차**: 회전방향을 알 수 있다.

 - **자기식 엔코더**: 스케일에 자석이 일정한 간격으로 N/S극이 반복적으로 배치되어 헤드가 스케일 위를 이동하면서 자기장 변화를 감지하고, 감지된 횟수를 측정해 변화량을 측정한다.  

 - **정전용량식 엔코더**: 회전판의 패턴이 바뀔 때 전극 간 정전용량이 바뀌는 것을 측정한다. (외부 전자기 간섭에 민감하다.) 

## 3.펄스와 해상도의 개념 및 관계

### 3-1. 펄스 개념
 - 엔코더가 회전 중에 출력하는 디지털 신호의 갯수이다.  

 - 하나의 **ON/OFF 사이클을 1펄스(Pulse)** 라고 부른다.

### 3-2. 해상도 개념
 - **1회전당 몇개의 펄스를 출력하는지를 나타내는 수치** 이다.

 - PPR(Pulses Per Revolution)=회전당 펄스 수로 표현한다.

 - 해상도 = 1000PPR이면, 축이 360도 회전하는 동안 1000개의 펄스가 발생한다는 것이고, 1펄스당 360/1000=0.36도 회전이라는 의미이다.

 - **1펄스당 각도** = 360도/PPR

 - **회전 각도** = 펄스 수*(360도/PPR)

### 3-3. 펄스와 해상도의 관계
 - **펄스 수가 많을 수록 해상도가 높다** 는 의미이고, 더 정밀하게 위치를 측정할 수 있게 된다.

 - 대부분의 증분형 엔코더는 펄스를 두채널(A상, B상)로 출력하고, 이 경우 위상차를 이용해 펄스를 더 많이 인식할 수 있다.
     - 1배 카운트(A상만 사용), 2배 카운트(A상 상승/하강 엣지), 4배 카운트(A상, B상 상승/하강 모두 사용) 

## 4.엔코더 데이터를 활용해 속도 및 거리를 계산하는 방법

### 4-1. 속도 계산
 - 속도(m/s) = (펄스 수/PPR) * (2pi *r(바퀴 반지름(m))) / t(측정 시간(s))
     - 예시: PPR = 1000, 0.2초 동안 펄스 수 = 500, 바퀴 반지름 = 0.05m 일때 --> 속도 = 500/1000 * 2pi * 0.05 / 0.2 = 0.785(m/s)

### 4-2. 거리 계산
 - **회전수 = 펄스 수 / 해상도(PPR)**

 - **이동거리(m) = 회전수 * 바퀴 둘레(2pi * r(바퀴 반지름(m)))**  
     - 예시: PPR = 1000, 측정된 펄스 수 = 2500, 바퀴 반지름 = 0.05m 일때 --> 이동거리 = 2500/1000*2pi*0.05 = 0.785(m)

## 5.엔코더 데이터와 실제 주행 결과와의 차이가 발생하는 이유 및 보정 방법

### 5-1. 엔코더 데이터와 실제 주행 결과 차이 발생 이유
 - **바퀴 미끌림(Slip)**: 바퀴가 헛도는 경우 실제 이동은 적지만 엔코더는 많이 회전한 것으로 인식한다.

 - **진동**: 바퀴가 뜨거나 튀는 경우, 엔코더 값은 있지만 실제 이동은 없는 상태이다.  

 - **센서 한계**: 펄스 수가 낮으면 미세한 움직임을 감지하지 못해 오차가 누적된다.

 - **마찰 계수 변화**: 오르막에서는 같은 회전수라도 실제 속도는 낮아질 수 있다.

### 5-2. 보정 방법
 - 실험을 통해 바퀴 둘레, 엔코더 PPR 등 기계 계수를 정확히 측정하고, 실제 주행거리와 엔코더 계산 결과를 비교하여 **보정 계수를 적용한다.**  
 (보정된 거리 = 원래 계산된 거리 * 보정 계수)
 
 - 엔코더는 미끄러짐을 구분할 수 없기 때문에 IMU센서, GPS센서등을 사용하여 **센서 퓨전을 활용해 정확도를 높인다.**

## 6. 질문
### 엔코더에는 시간을 측정하는 기능이 없는 걸로 아는데 속도 계산을 위해 mcu의 기능을 사용하여 시간값을 측정하는 것이 맞는지 궁금하고, 이 외에 속도를 측정하는 다른 방법이 있는지 알고싶다.