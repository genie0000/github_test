# 수행 목표
특정 상황에서 운반 로봇의 제어 상황을 파악한다.

# 운반 로봇 제어 학습
## 운반 로봇의 스펙
- 로봇의 바퀴 지름: 10cm
- 엔코더 해상도: 1회전 당 30펄스
- 두 바퀴 사이의 거리: 20cm
- IR 센서는 5cm 앞의 경로를 감지하는 3개의 센서 어레이로 구성되어 있다.
- 각 센서 어레이가 측정한 값은 흰색은 1, 검은색은 0이며, 경로는 검은색으로 표현되어 있다.

## 1. 주행 중에 000으로 유지되던 센서의 측정 값이 100으로 변경되었다. 로봇이 경로를 유지하기 위해서 필요한 제어 절차를 단계별로 구체적으로 정리해보자.(필요하다면 추가적인 가정을 사용해도 좋다.)
### 1-1. 추가 가정 및 로봇 스펙
 - **실제 경로가 우회전인 경우와 직진인 경우를 가정** 한다.
 - 3개의 IR센서가 일정 간격으로 로봇의 [좌측, 중간, 우측] 에 달려있다고 가정한다.
 - **센서 측청 값 [0, 0, 0]에서 왼쪽부터 [좌측, 중간, 우측] 센서의 출력값으로 가정** 한다.
 - 센서 어레이가 측정한 값은 흰색은 1, 검은색은 0이며, 경로는 검은색으로 표현되어 있다.

### 1-2. 경로 파악
 - 이 로봇에서 IR센서는 적외선을 물체에 쏘고, 그 빛이 얼마나 반사되었는지를 측정하여 검은색 경로를 찾는 역할을 수행한다.
 - 따라서 원래 [0,0,0]으로 유지되던 센서 측정값이 [1,0,0]으로 변경된것은 **검은선(경로)이 직진상태에서 오른쪽으로 휘어져 있음을 예측할 수 있다.**
 - 또한 **검은선(경로)이 직진을 유지하고 있고 현재 로봇도 직진상태이지만 정오차로 인해 왼쪽 센서값만 1이 나오는 경우도 예측할 수 있다.**

### 1-3. 경로를 유지하기 위한 로봇 제어
 - **경우1.** 검은선(경로)이 오른쪽으로 휘어져 있는 경우
     - **비례 제어(Kp)를 통해 강하게 제어하여 오른쪽으로 휘어져 있는 선을 다시 따라가게끔 제어** 한다.
     - 이 경우 좌측 센서에서 1값이 들어오면 왼쪽 바퀴의 모터 속도를 높이고, 오른쪽 바퀴의 속도를 줄이게끔 설정하여 계속해서 센서값이 [0,0,0]이 유지될 수 있게 설정 한다.

 - **경우2.** 검은선(경로)이 직진인 경우
     - 경로가 계속해서 직진이고 로봇도 직진을 잘 하고있었는데 **외부 요인으로 인해 차선을 이탈해 정오차가 발생한 상황일 경우 적분 제어(Ki)** 를 통해 오차를 누적시켜 줄여나가게 제어한다.
     - 이 경우도 왼쪽 바퀴의 속도를 높이고, 오른쪽 바퀴의 속도를 줄이게끔 설정하면 되지만, 두 바퀴 모터의 속도 차이는 경우1과 비교했을 때 더 작다.

 - **경우1,2 보완**
     - 경로가 급격하게 바뀌거나 센서 값이 빠르게 변할 경우, 비례 및 적분 제어만 사용할 경우 과제어로 인한 진동이 발생할 수 있다.
     - **오차의 급격한 변화를 줄이고 안정적인 제어를 원한다면 미분 제어(Kd)** 를 통해서 해결할 수 있다. 

## 2. 주행 중인 로봇에서 100펄스 동안 두 바퀴의 엔코더 측정값이 동일했는데, 이후 왼쪽 바퀴에서 20펄스가측정되는 동안 오른쪽 바퀴에서 10펄스가 측정되었다. 이후 50펄스 동안 엔코더 측정값이 동일했다. 이 로봇의 이동을 설명하라.(로봇이 이동한 거리와 만약 로봇이 회전했다면 회전 각도 및 회전 반경을 계산한 값을 사용해 설명해보자.)
### 2-1. 로봇의 스펙 확인
 - 펄스는 엔코더가 회전 중에 출력하는 디지털 신호의 갯수이고, 하나의 ON/OFF사이클을 1펄스(Pulse)라고 부른다.
 - 이 로봇에 사용된 엔코더는 1회전당 30펄스이므로 360도 회전하는 동안 30펄스가 발생한다는 것이고, 1펄스당 360/30 = 12도 회전하는 것을 알 수 있다.
 - 엔코더의 해상도 = 30PPR, 로봇 바퀴의 반지름 = 5cm, 두 바퀴 간 거리 = 20cm로 설계되어 있다.

### 2-2. 로봇의 이동 경로 확인
 - **처음 100펄스 동안 두 바퀴의 엔코더 측정값이 동일 = 직진**
 - **이후 왼쪽 바퀴에서 20펄스가 측정되는 동안 오른쪽 바퀴에서 10펄스가 측정됨 = 우회전**
 - **이후 50펄스 동안 엔코더 측정값이 동일 = 다시 직진**
 - 즉 처음 직진을 하다 우회전을 하고 다시 직진하는 경로로 로봇이 이동한 것을 알 수 있다.

### 2-3. 로봇의 이동 거리, 회전 각도, 회전 반경 계산
 1. 처음 직진 
     - **이동거리(m)** = 100/30 * 2pi * 0.05 = 1.047(m)

 2. 이후 우회전 
     - **왼쪽 바퀴 이동거리(m)**: Dl = 20/30 * 2pi * 0.05 = 0.209(m)
     - **오른쪽 바퀴 이동거리(m)**: Dr = 10/30 * 2pi * 0.05 = 0.105(m)
     - **회전 각도(rad) θ = (Dr - Dl)/L**: θ = (0.104 - 0.209) / 0.2 = -0.525(rad)
         - -0.525(rad) * 180 / pi = -30(도)
     - **회전 반경(m) R = (Dr + dl)/2θ**: R = (0.104 + 0.209)/(-0.525 * 2) = -0.298(m)
     - **회전 거리(m) = R * θ(절대값θ)** = 0.298 * 0.525 = 0.156(m) 

 3. 이후 다시 직진 
     - **이동거리(m)** = 50/30 * 2pi * 0.05 = 0.523(m)

 4. 즉 1.047(m)를 직진하다 --> 회전 반경: -0.298(m), 회전 각도: -0.525(rad)로  거리 0.156(m)만큼 우회전하고 --> 다시 0.523(m)만큼 직진한 것을 알 수 있다.
     - **따라서 총 이동거리는 1.727(m) 이다.**
