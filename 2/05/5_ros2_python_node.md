# 수행목표
ROS2의 노드를 파이썬으로 작성한다.

# 수행단계
## 1. ROS2 프로그램은 각 구성 요소를 노드로 정의한 후, 각 노드 간의 상호작용을 정의하는 방식으로 구현한다. 이를 위해서 ROS2의 모든 노드는 rclpy.node 모듈의 Node 클래스를 상속받아 정의한다. rclpy.node 모듈의 Node 클래스를 상속받아 노드 클래스를 작성하는 방법에 대해서 조사한다.
 - ROS2에서는 프로그램을 여러 개의 노드(Node)로 나눠서 만들고, 이렇게 나눠진 노드들이 서로 메시지를 주고받으며 협력해서 하나의 전체 시스템을 구성한다.
 - 이 노드를 Python으로 만들 때는 반드시 Node라는 클래스를 상속받아서 새 클래스를 만들어야 한다.
 - 이 Node 클래스는 rclpy.node라는 모듈에 들어있다.
 - 즉 ROS2에서 동작하는 노드를 만들기 위한 기본 툴을 제공해 주는 것이다.
1. 먼저 rclpy 모듈과 Node 클래스를 불러온다.
2. Node를 상속받아서 내가 만들고 싶은 노드 클래스를 정의한다.
3. 그 클래스 안에서 super().__init__('노드이름')을 호출해서 노드 이름을 정한다.
4. 그 다음 그 안에 퍼블리셔나 서브스크라이버, 타이머 같은 기능을 추가하면 된다.
5. 마지막으로 rclpy.init(), rclpy.spin() 같은 함수를 써서 이 노드를 실행하게 된다.
 - 이를 상속받아 노드를 만들면 퍼블리싱, 서브스크라이빙, 타이머 등 다양한 기능을 쉽게 구현할 수 있게 된다.

## 2. 노드 클래스의 객체를 생성하는 방법에 대해서 조사하고, rclpy.init(), rclpy.spin(), rclpy.shutdown() 세 함수의 역할 및 사용법에 대해서도 알아본다.
 - 노드를 만들기 위해서는 Node 클래스를 상속받아 새 클래스를 정의해야 한다. 그 이후 일반 Python 클래스처럼 객체를 생성하면 된다.
 - rclpy.init()의 역할
     - ROS2 시스템을 초기화하는 함수이다.
     - 이 함수는 ROS2 프로그램을 시작하기 전에 한 번만 호출해야 한다.
     - rclpy.init()  # ROS2 초기화
 - rclpy.spin()의 역할
     - 노드를 계속 실행하면서 콜백(callback)을 기다리는 함수이다.
     - 노드가 타이머, 퍼블리셔, 서브스크라이버 같은 것을 가지고 있다면 그것들이 작동하기 위해 spin()이 필요하다.
     - rclpy.spin(node)  # 노드 실행(이 노드를 돌리면서 이벤트를 기다려라는 의미이다.)
 - rclpy.shutdown()의 역할
     - ROS2 시스템을 종료(clean-up)할 때 사용하는 함수이다.
     - 노드를 다 사용한 후에 자원을 정리해주는 역할을 한다.
     - rclpy.shutdown()  # ROS2 종료 및 정리

## 3. 파이썬 프로그램을 만들 때 print() 함수를 사용해 화면에 메시지를 출력한다. 하지만 일반적인 로봇은 이를 출력할 화면을 가지고 있지 않다. 대신 로그의 형태로 기록을 남기는데, 이를 위해서 Node 클래스는 파이썬의 로깅 시스템과 연동해 로그 기록을 남길 수 있는 메서드를 제공한다. ROS2 노드에서 로그를 남기는 방법을 알아보자.
 - ROS2 로봇 또는 프로그램이 남긴 로그를 확인하는 방법을 알아보자.
 - 로봇은 화면이 없기 때문에 print()함수 보다 로그(log)를 남기는 방식으로 상태나 정보를 확인한다. ROS2에서는 이를 위해 Node클래스가 제공하는 로깅 메서드를 사용하여, 로그는 콘솔이나 로그 파일 등으로 확인할 수 있다.
 - debug(): 디버깅용 상세 로그
 - info(): 일반적인 정보 로그
 - warn(): 경고(문제는 아니지만 주의 필요)
 - error(): 오류 발생
 - fatal(): 심각한 오류 발생(치명적)

## 4. 다음과 같이 동작하는 ROS2 노드를 파이썬 프로그램으로 만들어본다. 이 프로그램의 파일 이름은 logging.py로 하고, 생성되는 노드의 이름도 logging_node로 한다.
- 노드의 이름을 정보 수준의 로그로 기록한다.
- 로봇이 계속 동작하듯 그 상태에서 프로그램이 계속 실행 상태로 남아 있는다.

## 5. 위의 노드를 ROS2에서 실행하기 위해서는 몇 가지 절차가 필요하다. 다음의 각각의 절차를 수행하는 방법을 조사한다.
### 5-1. setup.py 파일의 수정
 - entry_points에서 'console_scripts'안에 'logging = my_robot_controller.5_logging:main',을 작성한다.
### 5-2. 빌드 방법 및 파이썬 빌드 시스템에서 `--symlink-install` 옵션의 역할
 - colcon build --symlink-install
 - --symlink-install 옵션은 Python 파일을 복사하지 않고 심볼릭 링크로 연결한다.
 - 즉, src/my_robot_package/logging.py를 수정하면, 다시 빌드하지 않아도 바로 실행 반영됩니다.
### 5-3. 빌드 이후의 상황을 시스템에 적용한 후 제어 노드를 실행하는 방법
1. 빌드 후 환경 설정
 - source install/setup.bash
2. 만들어 둔 노드 실행
 - ros2 run [패키지이름] [실행명령어]

## 6. 파이썬 프로그램으로 만들어지는 노드가 logging_node라는 이름을 가지도록 setup.py 파일을 수정한 후, 실행해보자.
이전 단계에서 조사한 내용을 적용하며, 빌드할 때는 --symlink-install 옵션을 사용한다. 만약 --symlink-install 옵션으로 빌드가 되지 않는다면 아래 참고사항을 확인한다.

## 7. 조사한 내용을 형식 문서로 만들고 워크 스페이스 디렉토리를 압축해 함께 게시한다.
프로젝트 루트의 2/5 디렉토리를 생성한 후, 이 디렉토리 내에 문서 파일의 이름은 5_ros2_python_node.md(마크다운 파일의 경우)으로 저장, 게시한다. 워크스페이스 디렉토리를 압축한 파일도 함께 게시한다.